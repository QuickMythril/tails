From e3199a0259834d85802bd58b0f65124d6c63f0af Mon Sep 17 00:00:00 2001
From: anonym <anonym@riseup.net>
Date: Tue, 3 Nov 2020 12:13:10 +0100
Subject: [PATCH 3/3] Don't reset encryption choice when disabling encryption
 controls.

Without this, the mail.identity.default.encryptionpolicy pref does not
work: adding a key to an account always sets its encryptionpolicy to 0,
no matter the desired default.

https://bugzilla.mozilla.org/show_bug.cgi?id=1674995
---
 comm/mail/extensions/am-e2e/am-e2e.js | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/comm/mail/extensions/am-e2e/am-e2e.js b/comm/mail/extensions/am-e2e/am-e2e.js
index ff717553450..2cfa62a724b 100644
--- a/comm/mail/extensions/am-e2e/am-e2e.js
+++ b/comm/mail/extensions/am-e2e/am-e2e.js
@@ -431,8 +431,8 @@ function smimeSelectCert(smime_cert) {
 }
 
 function enableEncryptionControls(do_enable) {
-  gDisableEncryption.disabled = !do_enable;
-  gEnableEncryption.disabled = !do_enable;
+  gRequireEncrypt.disabled = !do_enable;
+  gDoNotEncrypt.disabled = !do_enable;
   if (!do_enable) {
     gEncryptionChoices.value = 0;
   }
-- 
2.37.2

