#!/bin/sh

set -e
set -u
set -x

# Import set_mozilla_pref()
. /usr/local/lib/tails-shell-library/tor-browser.sh

THUNDERBIRD_CONFIG_DIR="${HOME}/.thunderbird"
PROFILE="${THUNDERBIRD_CONFIG_DIR}/profile.default"

configure_locale() {
    # Thunderbird will set the locale based on the environment when
    # this pref is empty, but will then save the result to this pref
    # disabling this "guess" for the next time. We want Thunderbird to
    # always match the locale of the Tails session.
    set_mozilla_pref "${PROFILE}/prefs.js"   \
                     "intl.locale.requested" \
                     '""'                    \
                     user_pref
}

reconfigure_profile() {
    mkdir -p "${PROFILE}"
    configure_locale
}

start_thunderbird() {
    export GNOME_ACCESSIBILITY=1
    unset SESSION_MANAGER
    reconfigure_profile
    exec /usr/bin/thunderbird --class "Thunderbird" -profile "${PROFILE}" "${@}"
}

start_thunderbird "${@}"
