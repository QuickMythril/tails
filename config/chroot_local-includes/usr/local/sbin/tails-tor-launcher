#!/bin/sh

set -e

# Import export_gnome_env().
. /usr/local/lib/tails-shell-library/gnome.sh

# Get LIVE_USERNAME
. /etc/live/config.d/username.conf

# Get LANG
. /etc/default/locale

until pgrep -u "${LIVE_USERNAME}" '^ibus-daemon' >/dev/null ; do
   sleep 5
done

# Kill any existing instance, since multiple instances would be very
# confusing. This could easily happen if you have Tor Launcher open,
# and reconnect the network, which then will try to start it again.
pkill -x tca || :

export LANG
export_gnome_env
exec tca
