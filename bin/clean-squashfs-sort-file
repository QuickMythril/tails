#!/bin/bash

set -eu
set -x

perl -ni \
     -E 'chomp;
         last if m{\Ausr/local/lib/kill-boot-profile\s}xms;
         say unless m{
         [[:digit:]]+
         [[:space:]]+
         (?:
             .*[.]pyc\z
           | boot-profile[.]pid\z
           | lib/firmware/
           | lib/live/mount/medium/live/(?:filesystem[.]squashfs|initrd[.]img)\z
           | lib/live/mount/overlay/rw/etc/fstab\z
           | lib/live/mount/overlay/rw/etc/console-setup/cached_\S+[.](?:gz|sh)\z
           | lib/live/mount/overlay/rw/etc/machine-id\z
           | lib/live/mount/overlay/rw/etc/network/interfaces\z
           | lib/live/mount/overlay/rw/var/log/wtmp\z
           | (?:lib/live/mount/overlay/rw/)?etc/apparmor[.]d/cache/[.]features\z
           | (?:lib/live/mount/overlay/rw/)?etc/(?:group|gshadow|passwd|shadow)-\z
           | (?:lib/live/mount/overlay/rw/)?etc/resolv-over-clearnet[.]conf\z
           | (?:lib/live/mount/overlay/rw/)?etc/skel/[.]config/autostart/end-profile[.]desktop\z
           | lib/modules/.*/kernel/drivers/(?:cpufreq|net|thermal)/
           | lib/modules/.*/kernel/net/
           | usr/share/pulseaudio/alsa-mixer/
           | run/
           | var/lib/AccountsService/users/Debian-gdm\z
           | var/lib/gdm3/[#]\d+\z
           | var/log/live/config[.]pipe\z
         )}xms' \
     "$1"
